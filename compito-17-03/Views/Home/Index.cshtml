@{
	ViewData["Title"] = "Home Page";
}

<div class="text-center" id="tableContainer">
	<div id="detailsModal" class="modal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 id="detailsTitle" class="modal-title"></h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p id="detailsBody"></p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary">Save changes</button>
				</div>
			</div>
		</div>
</div>

@section Scripts {
	<script>
		document.addEventListener("DOMContentLoaded", async() => {
			const tableContainer = document.getElementById('tableContainer');
			try {
				let response = await fetch("studenti/get-all");
				if(response.ok) {

				let data = await response.text();
				tableContainer.innerHTML = data;

				} else {

					throw new Error("Errore")

				}
			} catch(error) {

				console.log(error, "Errore nel recupero dei dati")

			}

			new DataTable('#studentiTable', {
				ordering: true,
				columnDefs: [
					{
						orderable: true
					}
				]
			});

			async function showDetailsModal(id){
					let response = await fetch(`studenti/details/${id}`);

					if(response.ok){
						var detailsObj = await response.json();
						showModal(detailsObj);
					}

				}

				function showModal(response){

						let detailsModal = new bootstrap.Modal(document.getElementById('detailsModal'));

						let title = document.getElementById('detailsTitle');
						let body = document.getElementById('detailsBody');

						title.textContent = response.name, response.cognome;
						body.textContent = response.email, response.datanascita;

						detailsModal.show();
				}

	})
	</script>
}